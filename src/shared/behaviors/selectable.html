<link rel="import" href="domgettable.html"/>
<script>
(function (scope) {
	var Selectable = {
		properties: {
			filterElementType: {
				type: String,
				value: "mm-list-item"
			},
			filter: {
				type: Boolean,
				value: true
			},
			panel: {
				type: Object,
				value: function() { return this.$.panel; }
			},
			selectedIndex: {
				type: Number,
				value: null,
				observer: '_selectedIndexChanged'
			},
			highlightedIndex: {
				type: Number,
				value: null,
				observer: '_highlightedIndexChanged'
			},
			maxItems: {
				type: Number,
				value: false
			},
			maxHeight: {
				type: Number,
				value: false
			},
		},

		get items() {
			var itemsArr = null,
				elementType = this.filterElementType;

			if (this.filter) {
				itemsArr = this.data ? Polymer.dom(this.panel).querySelectorAll(elementType) :
				this.getLightDOM().filter(function(el) { return el.localName === elementType; });
			} else {
				itemsArr = Polymer.dom(this).queryDistributedElements(this.filterElementType);
			}
			// return (this.data) ?
			// 	Polymer.dom(this.panel).querySelectorAll(this.filterElementType) :
			// 	this.getLightDOM().filter(function(el) { return el.localName === this.filterElementType; });
			return itemsArr;
		},


		_selectedIndexChanged: function(newIndex,oldIndex) {
			if(typeof newIndex === 'number' && newIndex >= 0) this.attributeFollows('selected',this.items[newIndex],this.items[oldIndex]);
		},
		
		_highlightedIndexChanged: function(newIndex,oldIndex) {
			if(typeof newIndex === 'number' && newIndex >= 0) this.classFollows('highlighted',this.items[newIndex],this.items[oldIndex]);
		},

		// ***********************
		// TODO: display updates belong elsewhere
		// ***********************
		get itemHeight() {
	 		return this.items.length ? this.items[0].offsetHeight : 0;
		},

		_setMaxHeight: function(maxItems) {
			actualMax = Math.min(this.items.length, maxItems);
			if(this.$.container) this.$.container.style.height = Math.min((this.itemHeight * actualMax), window.innerHeight) + "px";
	 	}
	}

	scope.Selectable = [
		scope.DomGettable,
		Selectable
	];

})(window.StrandTraits = window.StrandTraits || {}); 
</script>