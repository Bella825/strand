<link rel="import" href="../js/datautils.html"/>
<link rel="import" href="../js/behaviorutils.html"/>
<link rel="import" href="syncable.html"/>
<script>
(function (scope) {

	var DataUtils = StrandLib.DataUtils;

	var Pageable = {

		properties: {
			page:{
				type:Number,
				value:0,
				observer:"_pageChanged"
			},
			pageSize:{
				type:Number,
				value:10,
				observer:"_pageSizeChanged"
			},
			pageOptions:{
				type:Object,
				value:function() {
					return {
						pageName:"page_offset",
						sizeName:"page_limit",
						url:false,
						query:true,
						body:false,
						pageType:Pageable.PAGE_TYPE_OFFSET,
					};
				}
			}
		},

		PAGE_TYPE_OFFSET:"offset",
		PAGE_TYPE_INDEX:"index",

		nextPage: function() {
			this.page++;
		},

		prevPage: function() {
			if (this.page > 0);
				this.page--;
		},

		sync:function(method, data, options) {
			
			var opts = this.pageOptions;
			options = this._getParamBase(options);
			var page = opts.pageType === this.PAGE_TYPE_OFFSET ? this.page * this.pageSize : this.page;

			if (opts.url) {
				if (opts.pageName) options.urlParams.push(DataUtils.param(opts.pageName, page));
				if (opts.sizeName) options.urlParams.push(DataUtils.param(opts.sizeName, this.pageSize));
			}
			if (this.pageOptions.query) {
				if (opts.pageName) options.params.push(DataUtils.param(opts.pageName, page));
				if (opts.sizeName) options.params.push(DataUtils.param(opts.sizeName, this.pageSize));
			}
			if (this.pageOptions.body && DataUtils.isType(data, "object")) {
				if (opts.pageName) data[opts.pageName] = page;
				if (opts.sizeName) data[opts.sizeName] = this.pageSize;
					
			}
			var sync = StrandLib.BehaviorUtils.findSuper(scope.Syncable, "sync");
			return sync.apply(this, [method,data,options]);
		},

		_pageChanged:function() {
			if (this.auto && this.auto !== "save" && this.page >= 0) {
				if (this.autoDebounce !== -1) {
					this.debounce("dom", this.get, this.autoDebounce);
				} else {
					this.get();
				}
			}
		},

		_pageSizeChanged: function() {
			if (this.auto && this.auto !== "Save" && this.pageSize > 0) {
				if (this.autoDebounce !== -1) {
					this.debounce("dom", this.get, this.autoDebounce);
				} else {
					this.get();
				}
			}
		}

	};

	scope.Pageable = [
		scope.Syncable,
		Pageable,
	];
}(window.StrandTraits = window.StrandTraits || {}));
</script>