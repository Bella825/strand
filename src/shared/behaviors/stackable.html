<script>
/**
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt

*/
(function (scope) {

	var _w = 10000, 
		_instances = {
		modal:{
			base:1*_w,
			max:2*_w,
			items:[],
		},
		ui:{
			base:2*_w,
			max:3*_w,
			items:[],
		},
		tooltip:{
			base:3*_w,
			max:4*_w,
			items:[],
		}
	};

	function _addInstance(instance, type) {
		var cat = _instances[type];
		if (cat && cat.items.length < cat.max) {
			// cat.items.push(instance);
			// instance._setDepth(cat.items.length + cat.base);
			instance._setDepth(cat.items.push(instance) + cat.base);
		} else {
			throw(new Error("Could not add item at " + cat.max));
		}
	}

	function _removeInstance(instance, type) {
		var cat = _instances[type];
		if (cat) {
			cat.items.splice(cat.items.indexOf(instance), 1);
		}
	}

	scope.Stackable = {

		properties: {
			stackHost: {
				type: Object,
				value: function() { return this; }
			},
			stackTarget: {
				type: Object,
				value: null,
				observer: "_stackTargetChanged"
			},
			depth: {
				readOnly: true,
				notify: true,
				type: Number,
				value: 0,
				observer: "_updateDepth"
			},
			stackType:{
				type: String,
				value: "ui",
				reflectToAttribute: true,
				observer:"_updateType"
			}
		},

		_initialized: false,

		attached: function() {
			_addInstance(this.stackHost, this.stackType);
			// We don't want to trigger a stack update when properties
			// are processed - initialized flag:
			this.initialized = true;
		},

		detached: function() {
			_removeInstance(this.stackHost, this.stackType);
		},

		_stackTargetChanged: function(newVal, oldVal) {
			if (newVal) this._updateStack();
		},

		_updateDepth: function() {
			if (this.stackTarget) {
				this.stackTarget.style.setProperty("z-index", this.depth);
			} else {
				this.stackHost.style.setProperty("z-index", this.depth);
			}
			// console.log("this.depth: ", this.depth);
		},

		_updateType: function(newVal, oldVal) {
			if (newVal) this._updateStack();
		},

		moveToTop: function() {
			this._updateStack();
			return this.depth;
		},

		_updateStack: function() {
			if (this._initialized) {
				_removeInstance(this.stackHost, this.stackType);
				_addInstance(this.stackHost, this.stackType);
			}
		},
	};

})(window.StrandTraits = window.StrandTraits || {}); 
</script>