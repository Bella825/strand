<link rel="import" href="datautils.html"/>
<script>
(function (scope) {

	var DataUtils = StrandLib.DataUtils;

	scope.AjaxPlugin = function(pluginQueue) {
		this.queue = [];
		if (pluginQueue) {
			this.queue = pluginQueue.map(function(p) {
				if (typeof p === "function")
					return new p();
			});
		}
	};
	scope.AjaxPlugin.prototype = {

		register: function(name, plugin, config) {
			var instance = typeof plugin === "function" ? new plugin() : plugin;
			if (config) {
				instance.config = DataUtils.copy(instance.config,config);
			}
			if (name) {
				instance.name = name;
			}
			this.queue.push(instance);
		},

		processRequest: function(data) {
			return this.process("requestHandler", data);
		},

		processResponse: function(data) {
			return this.process("responseHandler", data);
		},

		process: function(method, data) {
			data = data || {};
			config = this.config;
			return this.queue.reduce(function(prev, curr) {
				var out;
				if (curr[method])
					var out = curr[method](prev);
				if(curr.reset)
					curr.reset();
				return out || prev;
			}, data);
		},

		getConfig: function (name) {
			if(this.queue.length > 0) {
				var result = this.queue.filter(function(instance) {
					return instance.name === name;
				});
				return DataUtils.getPathValue("0.config",result);
			}
			return null;
		}
	};
})(window.StrandLib = window.StrandLib || {}); 
</script>