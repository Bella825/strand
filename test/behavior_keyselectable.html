<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../bower_components/webcomponentsjs/webcomponents.js"></script>
	<script src="../bower_components/web-component-tester/browser.js"></script>
	<script src="TestHelper.js"></script>
	<script>
		var should = chai.should();
	</script>
	<link rel="import" href="../build/shared/behaviors/keyselectable.html"/>
	<link rel="import" href="../bower_components/polymer/polymer.html"/>
</head>
<body>

	<test-keyselectable tabIndex="1" id="testElem"></test-keyselectable>

	<script>

		Polymer({
			is: 'test-keyselectable',
			behaviors: [StrandTraits.Keyselectable],

			properties: {
				alphaCounter: {type: Number, value: 0},
				numCounter: {type: Number, value: 0}
			},

			listeners: {
				'keydown': '_routeKeyEvent'
			},

			_onUp: function() { this.up = true; },
			_onDown: function() { this.down = true; },
			_onLeft: function() { this.left = true; },
			_onRight: function() { this.right = true; },

			_onAlpha: function() {
				this.alphaCounter++;
			},
			_onNum: function() {
				this.numCounter++;
			}
		});
		
		document.addEventListener("keydown", function(e) {
			console.log("key pressed: "+e.keyCode);
		});

		fireKeyEvent = function(keyCode) {
			var ke = new Event('Event');
			if(ke.initEvent) {
				ke.initEvent('keydown', true, true);
			}
			ke.keyCode = keyCode;
			ke.which = keyCode;

			document.activeElement.dispatchEvent(ke);
		}

		describe('keyselectable', function() {
			it('should increment highlightedIndex when down is pressed', function() {

			});

			it('should decrement highlightedIndex when up is pressed', function() {

			});

			it('should increment highlightedIndex by n when pg dn is pressed', function() {

			});

			it('should decrement highlightedIndex by n when pg up is pressed', function() {

			});

			it('should set highlightedIndex to 0 when home is pressed', function() {

			});

			it('should set highlightedIndex to last valid index when home is pressed', function() {

			});

			it('should set the selectedIndex to the highlightedIndex when enter is pressed', function() {

			});
		});
		
		/* Keyboard tests moved from pulldown button */
		// it("should open on keypress if closed", function(done) {
		// 	var button = document.getElementById('pdb');
		// 	button.close();
		// 	button.target.focus();
		// 	setTimeout(function() {
		// 		fireKeyEvent(40);
		// 		button.state.should.equal(button.STATE_OPENED);
		// 		done();
		// 	}, 100);
		// });

		// it("should not respond to keypress when not focused", function(done) {
		// 	var button = document.getElementById('pdb');
		// 	button.close();
		// 	button.target.blur();
		// 	setTimeout(function() {
		// 		fireKeyEvent(40);
		// 		button.state.should.equal(button.STATE_CLOSED);
		// 		done();
		// 	}, 100);
		// });

		// it("should be navigable with arrow keys", function(done) {
		// 	var button = document.getElementById('pdb');
		// 	button.target.focus();
		// 	setTimeout(function() {
		// 		var items = Polymer.dom(button).children.filter(function(e) { return e.localName === 'mm-list-item' });
		// 		fireKeyEvent(40);
		// 		fireKeyEvent(40);
		// 		button.focusedItem.should.equal(items[0]);
		// 		fireKeyEvent(38);
		// 		button.focusedItem.should.equal(items[2]);
		// 		fireKeyEvent(38)
		// 		button.focusedItem.should.equal(items[1]);
		// 		done();
		// 	}, 100);
		// });

		// it("should also be navigable with home/end, pg up/pg dn keys", function(done) {
		// 	var button = document.getElementById('pdb');
		// 	button.target.focus();
		// 	setTimeout(function() {
		// 		var items = Polymer.dom(button).children.filter(function(e) { return e.localName === 'mm-list-item' });
		// 		for(var i=0; i<100*Math.floor(Math.random()); i++) {
		// 			fireKeyEvent(40);
		// 		}
		// 		fireKeyEvent(33);
		// 		button.focusedItem.should.equal(items[0]);
		// 		fireKeyEvent(34);
		// 		button.focusedItem.should.equal(items[2]);
		// 		fireKeyEvent(36);
		// 		button.focusedItem.should.equal(items[0]);
		// 		fireKeyEvent(35);
		// 		button.focusedItem.should.equal(items[2]);
		// 		done();			
		// 	}, 100);
		// });

		// it("should select item on return", function(done) {
		// 	var button = document.getElementById('pdb')
		// 	button.target.focus();
		// 	setTimeout(function() {
		// 		var items = Polymer.dom(button).children.filter(function(e) { return e.localName === 'mm-list-item' });
		// 		for(var i=0; i<100*Math.floor(Math.random()); i++) {
		// 			fireKeyEvent(40);
		// 		}
		// 		var sel = button.focusedItem;
		// 		fireKeyEvent(13);
		// 		button.selectedItem.should.equal(sel);
		// 		button.state.should.equal(button.STATE_CLOSED);
		// 		done();
		// 	}, 100);
		// });

		// it("should close panel on escape", function(done) {
		// 	var button = document.getElementById('pdb');
		// 	button.target.focus();
		// 	setTimeout(function() {
		// 		fireKeyEvent(27);
		// 		button.state.should.equal(button.STATE_CLOSED);
		// 		done();
		// 	}, 100);
		// });

	</script>

</body>
</html>
