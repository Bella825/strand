<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../bower_components/webcomponentsjs/webcomponents.js"></script>
	<script src="../bower_components/web-component-tester/browser.js"></script>
	<script>
		var should = chai.should();
	</script>
	<link rel="import" href="../shared/js/ajaxplugin.html"/>
</head>
<body>
<script>
describe("AjaxPlugin", function() {

	it("should exist", function() {
		StrandLib.should.be.an.object;
		StrandLib.AjaxPlugin.should.be.an.object;
	});

	it("should handle basic plugin support", function() {
		var spy1 = sinon.spy();
		var spy2 = sinon.spy();
		var spy3 = sinon.spy();
		var pq = new StrandLib.AjaxPlugin();
		function TestPlugin(opts) {
			this.options = opts;
		};
		TestPlugin.prototype = {
			requestHandler:function(ajaxOptions) {
				spy1();
			},
			responseHandler: function(response) {
				spy2();
			},
			reset: function() {
				//clear any state as necessary
				spy3();
			}
		};
		pq.register(TestPlugin);
		pq.processRequest({test:'test'});
		pq.processResponse({test:'test'});
		spy1.calledOnce.should.be.true;
		spy2.calledOnce.should.be.true;
		spy3.calledTwice.should.be.true;

	});

	it("should handle empty plugins", function() {
		function EmptyPlugin() {};
		var pg = new StrandLib.AjaxPlugin();
		pg.register(EmptyPlugin);
		pg.processResponse();
		pg.processRequest();
		//basically just looking for error trap here
	});

	it("should pass values through", function() {
		var pq = new StrandLib.AjaxPlugin();
		function TestPlugin(opts) {
			this.options = opts;
		};
		TestPlugin.prototype = {
			requestHandler:function(ajaxOptions) {
				if (!ajaxOptions.count) ajaxOptions.count = 0;
				ajaxOptions.count++;
				return ajaxOptions;
			},
			responseHandler: function(response) {
				return response;
			}
		};
		pq.register(TestPlugin);
		pq.register(TestPlugin);
		var t1 = pq.processRequest({test:'test'});
		var t2 = pq.processResponse({test:'test'});
		t1.should.deep.equal({test:'test',count:2});
		t2.should.deep.equal({test:'test'});
	});

});
</script>
</body>
</html>
