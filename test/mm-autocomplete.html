<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../bower_components/webcomponentsjs/webcomponents.js"></script>
	<script src="../bower_components/web-component-tester/browser.js"></script>
	<script src="TestHelper.js"></script>
	<script>
		var should = chai.should();
	</script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.js"></script>
	<link rel="import" href="../build/mm-autocomplete/mm-autocomplete.html">
	<link rel="import" href="../build/mm-pulldown-panel/mm-pulldown-panel.html">
	<link rel="import" href="../build/mm-list-item/mm-list-item.html">
</head>
<body>

<mm-autocomplete id="ac"></mm-autocomplete>
<mm-autocomplete id="ac2"></mm-autocomplete>

<script>
	describe("mm-autocomplete", function() {

		var data = [
				{name: "abelian", value: "abelian"},
				{name: "pylorus", value: "pylorus"},
				{name: "hainault", value: "hainault"},
				{name: "omnidirectional", value: "omnidirectional"},
				{name: "pul", value: "pul"},
				{name: "antipastos", value: "antipastos"},
				{name: "unwaxed", value: "unwaxed"},
				{name: "mira", value: "mira"},
				{name: "subconferential", value: "subconferential"},
				{name: "chromolithographic", value: "chromolithographic"},
				{name: "cocainism", value: "cocainism"},
				{name: "united", value: "united"},
				{name: "conroy", value: "conroy"},
				{name: "marsden", value: "marsden"},
				{name: "zoon", value: "zoon"},
				{name: "axiopoenus", value: "axiopoenus"},
				{name: "quarrion", value: "quarrion"},
				{name: "eliminated", value: "eliminated"},
				{name: "postcode", value: "postcode"},
			],
			ac = document.querySelector('#ac');

		it("should have an element constructor", function() {
			var a = new Strand.AutoComplete();
			a.nodeName.should.equal("MM-AUTOCOMPLETE");
		});

		it("should have data", function() {		
			ac.data = data;
			ac.data.should.equal(data);
		});

		it("should build a list of matching data", function() {
			ac.value = 'abelian';
			ac._searchData.should.have.length(1);
			ac._searchData[0].value.should.equal('abelian');
		});

		it("should open if there are matching items", function(done) {
			ac.value = 'a';
			setTimeout(function() {
				ac.state.should.equal(ac.STATE_OPENED);
				done();
			},100);
		});

		it("should close if there are no matching items", function(done) {
			ac.value = 'abcdefghijkl';
			setTimeout(function() {
				ac.state.should.equal(ac.STATE_CLOSED);
				done();
			},100);
		});

		it("should update value on selection", function() {
			ac.value = 'a';
			var tmp = ac._searchData[0].value;
			ac.selectedIndex = 0;
			ac.value.should.equal(tmp);
		});

		it("should fire a selected event", function() {
			var ac2 = document.querySelector('#ac2'),
				s = sinon.spy();
			ac2.data = data;
			ac2.addEventListener('selected', s);
			ac2.value = 'a';
			ac2.selectedIndex = 1;

			s.should.have.been.calledOnce;
			s.args[0][0].detail.should.have.keys('item','index','value','name','selected');
		});

	});
</script>

</body>
</html>