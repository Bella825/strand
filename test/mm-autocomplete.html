<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../bower_components/webcomponentsjs/webcomponents.js"></script>
	<script src="../bower_components/web-component-tester/browser.js"></script>
	<script src="TestHelper.js"></script>
	<script>
		var should = chai.should();
	</script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.js"></script>
	<link rel="import" href="../build/mm-autocomplete/mm-autocomplete.html">
	<link rel="import" href="../build/mm-pulldown-panel/mm-pulldown-panel.html">
	<link rel="import" href="../build/mm-list-item/mm-list-item.html">
</head>
<body>

<mm-autocomplete id="ac"></mm-autocomplete>

<script>
	document.addEventListener("WebComponentsReady", function() {
		var dataTest = document.getElementById('ac');
		dataTest.data = [
			{name: "abelian", value: "abelian"},
			{name: "pylorus", value: "pylorus"},
			{name: "hainault", value: "hainault"},
			{name: "omnidirectional", value: "omnidirectional"},
			{name: "pul", value: "pul"},
			{name: "antipastos", value: "antipastos"},
			{name: "unwaxed", value: "unwaxed"},
			{name: "mira", value: "mira"},
			{name: "subconferential", value: "subconferential"},
			{name: "chromolithographic", value: "chromolithographic"},
			{name: "cocainism", value: "cocainism"},
			{name: "united", value: "united"},
			{name: "conroy", value: "conroy"},
			{name: "marsden", value: "marsden"},
			{name: "zoon", value: "zoon"},
			{name: "axiopoenus", value: "axiopoenus"},
			{name: "quarrion", value: "quarrion"},
			{name: "eliminated", value: "eliminated"},
			{name: "postcode", value: "postcode"},
		]
	});

	describe("mm-autocomplete", function() {
	
		it("should have an element constructor", function() {
			var a = new Strand.AutoComplete();
			a.nodeName.should.equal("MM-AUTOCOMPLETE");
		});

		it("should open if there are matching items", function(done) {
			var ac = document.getElementById('ac');
			ac.value = 'a';

			setTimeout(function() {
				ac.panel.state.should.equal(ac.panel.STATE_OPENED);
				done();
			}, 100);
		});

		it("should not open if there are no matches", function(done) {
			var ac = document.getElementById('ac');
			ac.value = 'abcdefghijkl';

			setTimeout(function() {
				ac.panel.state.should.equal(ac.panel.STATE_CLOSED);
				done();
			}, 100);
		});

		it("should filter items", function(done) {
			var ac = document.getElementById('ac');
			ac.value = 'ab';

			setTimeout(function() {
				ac.searchItems.length.should.equal(1);
				should.equal(ac.panel.$.container.firstElementChild.value, ac.searchItems[0].value);			
				done();
			}, 100);
		});

		it("should update value when selected", function(done) {
			var ac = document.getElementById('ac');
			ac.value = 'om';
			
			setTimeout(function() {
				var expected = ac.panel.$.container.firstElementChild.value;
				ac.selectedItem = ac.panel.$.container.firstElementChild;
				ac.value.should.equal(expected);
				done();
			}, 100);
		});

	});
</script>

</body>
</html>