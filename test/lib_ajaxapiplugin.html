<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../bower_components/webcomponentsjs/webcomponents.js"></script>
	<script src="../bower_components/web-component-tester/browser.js"></script>
	<script>
		var should = chai.should();
	</script>
	<link rel="import" href="../build/shared/js/ajaxplugin.html"/>
	<link rel="import" href="../build/shared/js/ajaxapiplugin.html"/>
</head>
<body>
<script>
describe("AjaxPlugin", function() {

	it("should exist", function() {
		StrandLib.should.be.an.object;
		StrandLib.AjaxPlugin.should.be.an.object;
		StrandLib.AjaxAPIPlugin.should.be.an.object;
	});

	it("should handle basic plugin support", function() {

		var pq = new StrandLib.AjaxPlugin();
		pq.register(StrandLib.AjaxAPIPlugin);
		var plug = pq.queue[0];
		var spy2 = sinon.spy(plug, "responseHandler"); 

		pq.processRequest({test:'test'});
		pq.processResponse({test:'test'});
		
		spy2.calledOnce.should.be.true;

	});

	it("should handle malformed param objects", function() {
		var api = new StrandLib.AjaxAPIPlugin();
		api.responseHandler(null);
		api.responseHandler(-1);
		api.responseHandler({});
		api.responseHandler([]);
	});

	it("should handle no config options with a noop", function() {
		var xhr = sinon.useFakeXMLHttpRequest();
		var request;
		xhr.onCreate = function(req) {
			request = req;
		};
		var x = new XMLHttpRequest();
		x.open("get", "/", true);
		request.respond(200, { 
			"Content-Type": "application/json",
			"X-CSRF-Token": "presetPRESETpreset" 
		}, '{ "id": 1 }');

		var response = {
			instance:{
				xhr:x
			}
		};

		var api = new StrandLib.AjaxAPIPlugin();

		xhr.restore();
	});	

	it("should stop when disabled", function() {

	});

});
</script>
</body>
</html>